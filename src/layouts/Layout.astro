---
import '../styles/global.css';
import Comments from '../components/Comments.astro';

// Use frontmatter props if they exist (standard for Astro Markdown layouts)
const { frontmatter } = Astro.props;
const title = frontmatter?.title || Astro.props.title || "Jeff Patton | Cloud Architect";
const description = frontmatter?.description || Astro.props.description || "Technical insights on Azure, AWS, and Cybersecurity";

// Logical check to see if the user is viewing a blog post
const isBlogPost = Astro.url.pathname.startsWith('/blog');
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<meta name="description" content={description} />
		
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />

		<script is:inline>
			(function(n,i,v,r,s,c,x,z){x=window.AwsRumClient={q:[],n:n,i:i,v:v,r:r,c:c};window[n]=function(c,p){x.q.push({c:c,p:p});};z=document.createElement('script');z.async=true;z.src=s;document.head.insertBefore(z,document.head.getElementsByTagName('script')[0]);})(
				'cwr',
				'ceedfa36-a442-4a90-af3f-5038bc82c84e',
				'1.0.0',
				'us-east-1',
				'https://client.rum.us-east-1.amazonaws.com/1.19.0/cwr.js',
				{
					sessionSampleRate: 1 ,
					identityPoolId: "us-east-1:5158c3c8-d592-4bc0-810b-7f15eb0376a8" ,
					endpoint: "https://dataplane.rum.us-east-1.amazonaws.com" ,
					telemetries: ["performance","errors","http"] ,
					allowCookies: true ,
					enableXRay: false ,
					signing: true
				}
			);
		</script>
	</head>
	<body class="bg-slate-50 text-slate-900 antialiased">
		<main class="max-w-4xl mx-auto px-6 py-12">
			<nav class="mb-12 border-b border-slate-200 pb-6">
				<a href="/" class="font-bold text-xl hover:text-blue-600 transition">Patton Tech Blog</a>
			</nav>

			{/* If it's a blog post, display the title and date at the top automatically */}
			{isBlogPost && (
				<header class="mb-8">
					<h1 class="text-4xl font-extrabold text-slate-900 mb-2">{title}</h1>
					{frontmatter?.pubDate && (
						<time class="text-slate-500 font-mono text-sm">
							{new Date(frontmatter.pubDate).toLocaleDateString()}
						</time>
					)}
				</header>
			)}
			
			<article class="prose prose-slate prose-lg max-w-none">
				<slot />
			</article>

			{/* Only render the Giscus component on blog pages */}
			{isBlogPost && <Comments />}

			<footer class="mt-20 pt-8 border-t border-slate-200 text-sm text-slate-500">
				&copy; {new Date().getFullYear()} Jeffrey Patton. Built with Astro & AWS.
			</footer>
		</main>
	</body>
</html>
